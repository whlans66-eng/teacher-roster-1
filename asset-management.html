<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>èµ„äº§ç®¡ç†ç³»ç»Ÿ</title>

  <!-- Tailwind & Chart.js & Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- QuaggaJS for Barcode Scanning -->
  <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.4/dist/quagga.min.js"></script>

  <style>
    body{box-sizing:border-box;font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;}
    .glass-effect{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.2);}
    .gradient-bg{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;}
    .card-hover{transition:all .4s cubic-bezier(.175,.885,.32,1.275);}
    .card-hover:hover{transform:translateY(-8px) scale(1.02);box-shadow:0 25px 50px rgba(0,0,0,.15);}
    .stat-gradient-1{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);}
    .stat-gradient-2{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);}
    .stat-gradient-3{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);}
    .stat-gradient-4{background:linear-gradient(135deg,#43e97b 0%,#38f9d7 100%);}
    .floating{animation:floating 3s ease-in-out infinite;}
    @keyframes floating{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
    .slide-in{animation:slideIn .6s ease-out;}
    @keyframes slideIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    .chart-container{position:relative;height:300px;}
    .modern-input{background:rgba(255,255,255,0.9);border:2px solid transparent;transition:all .3s;}
    .modern-input:focus{background:#fff;border-color:#667eea;box-shadow:0 0 0 4px rgba(102,126,234,.1);}
    .modern-btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);transition:all .3s;position:relative;overflow:hidden;}
    .modern-btn:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(102,126,234,.3);}
    .modern-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s;}
    .modern-btn:hover::before{left:100%;}
    .status-badge{display:inline-block;padding:0.25rem 0.75rem;border-radius:9999px;font-size:0.75rem;font-weight:600;}
    .status-available{background:#d1fae5;color:#065f46;}
    .status-borrowed{background:#fef3c7;color:#92400e;}
    .status-maintenance{background:#fecaca;color:#991b1b;}
    .status-scrapped{background:#e5e7eb;color:#374151;}
    #barcode-scanner{width:100%;max-width:500px;height:300px;border:2px solid #667eea;border-radius:12px;}
    .tab-button{padding:0.75rem 1.5rem;border-radius:0.75rem;font-weight:600;transition:all 0.3s;}
    .tab-button.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;box-shadow:0 4px 12px rgba(102,126,234,.3);}
    .tab-button:not(.active){color:#6b7280;}
    .tab-button:not(.active):hover{background:rgba(102,126,234,0.1);}
  </style>
</head>
<body class="gradient-bg">
  <div class="min-h-screen p-6">
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <div class="glass-effect rounded-2xl p-6 mb-6 slide-in">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <div class="floating">
            <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-3xl shadow-lg">ğŸ“¦</div>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-800">èµ„äº§ç®¡ç†ç³»ç»Ÿ</h1>
            <p class="text-gray-600">Asset Management System</p>
          </div>
        </div>
        <div class="flex space-x-3">
          <button onclick="openAddAssetModal()" class="modern-btn text-white px-6 py-3 rounded-xl font-medium">
            â• æ–°å¢èµ„äº§
          </button>
          <button onclick="openBarcodeScanner()" class="modern-btn text-white px-6 py-3 rounded-xl font-medium">
            ğŸ“· æ‰«ææ¡ç 
          </button>
          <button onclick="openInventoryModal()" class="modern-btn text-white px-6 py-3 rounded-xl font-medium">
            ğŸ“‹ ç›˜ç‚¹
          </button>
        </div>
      </div>
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6 slide-in">
      <div class="glass-effect rounded-2xl p-6 card-hover">
        <div class="flex items-center justify-between mb-4">
          <div class="stat-gradient-1 p-3 rounded-xl">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
            </svg>
          </div>
        </div>
        <h3 class="text-sm font-medium text-gray-600 mb-1">æ€»èµ„äº§æ•°</h3>
        <p id="totalAssets" class="text-3xl font-bold text-gray-800">0</p>
        <p class="text-xs text-gray-500 mt-1">å…¨éƒ¨èµ„äº§</p>
      </div>
      <div class="glass-effect rounded-2xl p-6 card-hover">
        <div class="flex items-center justify-between mb-4">
          <div class="stat-gradient-2 p-3 rounded-xl">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
        </div>
        <h3 class="text-sm font-medium text-gray-600 mb-1">å¯ç”¨èµ„äº§</h3>
        <p id="availableAssets" class="text-3xl font-bold text-gray-800">0</p>
        <p class="text-xs text-gray-500 mt-1">å¯å€Ÿç”¨</p>
      </div>
      <div class="glass-effect rounded-2xl p-6 card-hover">
        <div class="flex items-center justify-between mb-4">
          <div class="stat-gradient-3 p-3 rounded-xl">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
          </div>
        </div>
        <h3 class="text-sm font-medium text-gray-600 mb-1">å·²å€Ÿå‡º</h3>
        <p id="borrowedAssets" class="text-3xl font-bold text-gray-800">0</p>
        <p class="text-xs text-gray-500 mt-1">ä½¿ç”¨ä¸­</p>
      </div>
      <div class="glass-effect rounded-2xl p-6 card-hover">
        <div class="flex items-center justify-between mb-4">
          <div class="stat-gradient-4 p-3 rounded-xl">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </div>
        </div>
        <h3 class="text-sm font-medium text-gray-600 mb-1">ç»´ä¿®ä¸­</h3>
        <p id="maintenanceAssets" class="text-3xl font-bold text-gray-800">0</p>
        <p class="text-xs text-gray-500 mt-1">ç»´æŠ¤ä¿å…»</p>
      </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="glass-effect rounded-2xl p-6 mb-6">
      <!-- Tab å¯¼èˆª -->
      <div class="flex space-x-2 mb-6 overflow-x-auto pb-2">
        <button onclick="switchTab('assets')" class="tab-button active" data-tab="assets">ğŸ“¦ èµ„äº§åˆ—è¡¨</button>
        <button onclick="switchTab('borrow')" class="tab-button" data-tab="borrow">ğŸ“¤ å€Ÿç”¨/å½’è¿˜</button>
        <button onclick="switchTab('maintenance')" class="tab-button" data-tab="maintenance">ğŸ”§ ç»´ä¿®è®°å½•</button>
        <button onclick="switchTab('scrapped')" class="tab-button" data-tab="scrapped">ğŸ—‘ï¸ æŠ¥åºŸç®¡ç†</button>
        <button onclick="switchTab('history')" class="tab-button" data-tab="history">ğŸ“Š ä½¿ç”¨å†å²</button>
        <button onclick="switchTab('charts')" class="tab-button" data-tab="charts">ğŸ“ˆ ç»Ÿè®¡åˆ†æ</button>
      </div>

      <!-- èµ„äº§åˆ—è¡¨ Tab -->
      <div id="tab-assets" class="tab-content">
        <div class="mb-4 flex flex-wrap gap-3">
          <input type="text" id="searchAsset" placeholder="æœç´¢èµ„äº§åç§°ã€ç¼–å·..." class="modern-input px-4 py-2 rounded-xl flex-1 min-w-[200px]" oninput="filterAssets()">
          <select id="filterCategory" class="modern-input px-4 py-2 rounded-xl" onchange="filterAssets()">
            <option value="">æ‰€æœ‰åˆ†ç±»</option>
            <option value="ç”µå­è®¾å¤‡">ç”µå­è®¾å¤‡</option>
            <option value="åŠå…¬è®¾å¤‡">åŠå…¬è®¾å¤‡</option>
            <option value="å®¶å…·">å®¶å…·</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
          <select id="filterStatus" class="modern-input px-4 py-2 rounded-xl" onchange="filterAssets()">
            <option value="">æ‰€æœ‰çŠ¶æ€</option>
            <option value="available">å¯ç”¨</option>
            <option value="borrowed">å·²å€Ÿå‡º</option>
            <option value="maintenance">ç»´ä¿®ä¸­</option>
            <option value="scrapped">å·²æŠ¥åºŸ</option>
          </select>
        </div>
        <div id="assetsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </div>

      <!-- å€Ÿç”¨/å½’è¿˜ Tab -->
      <div id="tab-borrow" class="tab-content hidden">
        <div class="mb-4">
          <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ“¤ å€Ÿç”¨èµ„äº§</h3>
          <form id="borrowForm" class="space-y-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">èµ„äº§ç¼–å·</label>
                <input type="text" id="borrowAssetId" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="æ‰«ææˆ–è¾“å…¥èµ„äº§ç¼–å·" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">å€Ÿç”¨äºº</label>
                <input type="text" id="borrower" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="å€Ÿç”¨äººå§“å" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">å€Ÿç”¨æ—¥æœŸ</label>
                <input type="date" id="borrowDate" class="modern-input w-full px-4 py-2 rounded-xl" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">é¢„è®¡å½’è¿˜æ—¥æœŸ</label>
                <input type="date" id="returnDate" class="modern-input w-full px-4 py-2 rounded-xl" required>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">å¤‡æ³¨</label>
              <textarea id="borrowNote" class="modern-input w-full px-4 py-2 rounded-xl" rows="2" placeholder="å€Ÿç”¨åŸå› æˆ–å¤‡æ³¨"></textarea>
            </div>
            <button type="submit" class="modern-btn text-white px-6 py-2 rounded-xl font-medium">ç¡®è®¤å€Ÿç”¨</button>
          </form>
        </div>
        <hr class="my-6 border-gray-300">
        <div>
          <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ“¥ å½’è¿˜èµ„äº§</h3>
          <div id="borrowedList" class="space-y-3"></div>
        </div>
      </div>

      <!-- ç»´ä¿®è®°å½• Tab -->
      <div id="tab-maintenance" class="tab-content hidden">
        <div class="mb-4">
          <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ”§ æ–°å¢ç»´ä¿®è®°å½•</h3>
          <form id="maintenanceForm" class="space-y-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">èµ„äº§ç¼–å·</label>
                <input type="text" id="maintenanceAssetId" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="æ‰«ææˆ–è¾“å…¥èµ„äº§ç¼–å·" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ç»´ä¿®æ—¥æœŸ</label>
                <input type="date" id="maintenanceDate" class="modern-input w-full px-4 py-2 rounded-xl" required>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">æ•…éšœæè¿°</label>
              <textarea id="maintenanceIssue" class="modern-input w-full px-4 py-2 rounded-xl" rows="2" placeholder="æè¿°æ•…éšœæƒ…å†µ" required></textarea>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ç»´ä¿®æ–¹æ¡ˆ</label>
              <textarea id="maintenanceSolution" class="modern-input w-full px-4 py-2 rounded-xl" rows="2" placeholder="ç»´ä¿®å¤„ç†æ–¹æ¡ˆ"></textarea>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ç»´ä¿®è´¹ç”¨</label>
                <input type="number" id="maintenanceCost" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="ç»´ä¿®è´¹ç”¨ï¼ˆå…ƒï¼‰" min="0" step="0.01">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ç»´ä¿®çŠ¶æ€</label>
                <select id="maintenanceStatus" class="modern-input w-full px-4 py-2 rounded-xl">
                  <option value="pending">å¾…ç»´ä¿®</option>
                  <option value="processing">ç»´ä¿®ä¸­</option>
                  <option value="completed">å·²å®Œæˆ</option>
                </select>
              </div>
            </div>
            <button type="submit" class="modern-btn text-white px-6 py-2 rounded-xl font-medium">æäº¤ç»´ä¿®è®°å½•</button>
          </form>
        </div>
        <hr class="my-6 border-gray-300">
        <div>
          <h3 class="text-xl font-bold text-gray-800 mb-3">ç»´ä¿®è®°å½•åˆ—è¡¨</h3>
          <div id="maintenanceList" class="space-y-3"></div>
        </div>
      </div>

      <!-- æŠ¥åºŸç®¡ç† Tab -->
      <div id="tab-scrapped" class="tab-content hidden">
        <div class="mb-4">
          <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ—‘ï¸ èµ„äº§æŠ¥åºŸ</h3>
          <form id="scrapForm" class="space-y-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">èµ„äº§ç¼–å·</label>
                <input type="text" id="scrapAssetId" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="æ‰«ææˆ–è¾“å…¥èµ„äº§ç¼–å·" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">æŠ¥åºŸæ—¥æœŸ</label>
                <input type="date" id="scrapDate" class="modern-input w-full px-4 py-2 rounded-xl" required>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">æŠ¥åºŸåŸå› </label>
              <textarea id="scrapReason" class="modern-input w-full px-4 py-2 rounded-xl" rows="3" placeholder="è¯´æ˜æŠ¥åºŸåŸå› " required></textarea>
            </div>
            <button type="submit" class="modern-btn text-white px-6 py-2 rounded-xl font-medium bg-red-500 hover:bg-red-600">ç¡®è®¤æŠ¥åºŸ</button>
          </form>
        </div>
        <hr class="my-6 border-gray-300">
        <div>
          <h3 class="text-xl font-bold text-gray-800 mb-3">å·²æŠ¥åºŸèµ„äº§</h3>
          <div id="scrappedList" class="space-y-3"></div>
        </div>
      </div>

      <!-- ä½¿ç”¨å†å² Tab -->
      <div id="tab-history" class="tab-content hidden">
        <div class="mb-4 flex gap-3">
          <input type="text" id="historySearch" placeholder="æœç´¢èµ„äº§ç¼–å·æˆ–å€Ÿç”¨äºº..." class="modern-input px-4 py-2 rounded-xl flex-1" oninput="filterHistory()">
        </div>
        <div id="historyList" class="space-y-3"></div>
      </div>

      <!-- ç»Ÿè®¡åˆ†æ Tab -->
      <div id="tab-charts" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="glass-effect rounded-2xl p-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">èµ„äº§çŠ¶æ€åˆ†å¸ƒ</h3>
            <div class="chart-container"><canvas id="statusChart"></canvas></div>
          </div>
          <div class="glass-effect rounded-2xl p-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">èµ„äº§åˆ†ç±»ç»Ÿè®¡</h3>
            <div class="chart-container"><canvas id="categoryChart"></canvas></div>
          </div>
          <div class="glass-effect rounded-2xl p-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">æœˆåº¦å€Ÿç”¨è¶‹åŠ¿</h3>
            <div class="chart-container"><canvas id="borrowTrendChart"></canvas></div>
          </div>
          <div class="glass-effect rounded-2xl p-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">ç»´ä¿®è´¹ç”¨ç»Ÿè®¡</h3>
            <div class="chart-container"><canvas id="maintenanceCostChart"></canvas></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- æ–°å¢èµ„äº§ Modal -->
  <div id="addAssetModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="glass-effect rounded-2xl p-8 max-w-2xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
      <h3 class="text-2xl font-bold text-gray-800 mb-6">â• æ–°å¢èµ„äº§</h3>
      <form id="assetForm" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">èµ„äº§ç¼–å·</label>
            <input type="text" id="assetId" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">èµ„äº§åç§°</label>
            <input type="text" id="assetName" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="ä¾‹å¦‚ï¼šæŠ•å½±ä»ª" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">èµ„äº§åˆ†ç±»</label>
            <select id="assetCategory" class="modern-input w-full px-4 py-2 rounded-xl" required>
              <option value="">è¯·é€‰æ‹©</option>
              <option value="ç”µå­è®¾å¤‡">ç”µå­è®¾å¤‡</option>
              <option value="åŠå…¬è®¾å¤‡">åŠå…¬è®¾å¤‡</option>
              <option value="å®¶å…·">å®¶å…·</option>
              <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">æ¡ç å·</label>
            <input type="text" id="assetBarcode" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="æ‰«ææˆ–è¾“å…¥æ¡ç ">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">è´­ä¹°æ—¥æœŸ</label>
            <input type="date" id="purchaseDate" class="modern-input w-full px-4 py-2 rounded-xl" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">è´­ä¹°ä»·æ ¼ï¼ˆå…ƒï¼‰</label>
            <input type="number" id="assetPrice" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="0.00" min="0" step="0.01">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">å­˜æ”¾ä½ç½®</label>
            <input type="text" id="assetLocation" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="ä¾‹å¦‚ï¼šAæ ‹101">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">åˆå§‹çŠ¶æ€</label>
            <select id="assetStatus" class="modern-input w-full px-4 py-2 rounded-xl">
              <option value="available">å¯ç”¨</option>
              <option value="maintenance">ç»´ä¿®ä¸­</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">èµ„äº§æè¿°</label>
          <textarea id="assetDescription" class="modern-input w-full px-4 py-2 rounded-xl" rows="3" placeholder="è¯¦ç»†æè¿°èµ„äº§ä¿¡æ¯ã€è§„æ ¼ã€å‹å·ç­‰"></textarea>
        </div>
        <div class="flex justify-end space-x-4 pt-4">
          <button type="button" onclick="closeAddAssetModal()" class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-xl font-medium transition-colors">å–æ¶ˆ</button>
          <button type="submit" class="modern-btn px-6 py-3 text-white rounded-xl font-medium">ç¡®è®¤æ–°å¢</button>
        </div>
      </form>
    </div>
  </div>

  <!-- æ¡ç æ‰«æ Modal -->
  <div id="barcodeScannerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="glass-effect rounded-2xl p-8 max-w-2xl w-full mx-4 shadow-2xl">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-gray-800">ğŸ“· æ‰«ææ¡ç </h3>
        <button onclick="closeBarcodeScanner()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
      </div>
      <div class="flex flex-col items-center space-y-4">
        <div id="barcode-scanner" class="bg-gray-900 rounded-xl overflow-hidden"></div>
        <div class="w-full">
          <label class="block text-sm font-medium text-gray-700 mb-2">æˆ–æ‰‹åŠ¨è¾“å…¥æ¡ç ï¼š</label>
          <input type="text" id="manualBarcode" class="modern-input w-full px-4 py-2 rounded-xl" placeholder="ä½¿ç”¨æ‰«ç æªæˆ–æ‰‹åŠ¨è¾“å…¥" autofocus>
        </div>
        <button onclick="searchAssetByBarcode()" class="modern-btn text-white px-6 py-3 rounded-xl font-medium w-full">æŸ¥è¯¢èµ„äº§</button>
      </div>
    </div>
  </div>

  <!-- èµ„äº§è¯¦æƒ… Modal -->
  <div id="assetDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="glass-effect rounded-2xl p-8 max-w-3xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-gray-800">ğŸ“¦ èµ„äº§è¯¦æƒ…</h3>
        <button onclick="closeAssetDetail()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
      </div>
      <div id="assetDetailContent"></div>
    </div>
  </div>

  <!-- ç›˜ç‚¹ Modal -->
  <div id="inventoryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="glass-effect rounded-2xl p-8 max-w-4xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-gray-800">ğŸ“‹ èµ„äº§ç›˜ç‚¹</h3>
        <button onclick="closeInventoryModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
      </div>
      <div class="mb-4">
        <p class="text-gray-600 mb-2">ç›˜ç‚¹æ—¥æœŸï¼š<span id="inventoryDate" class="font-semibold"></span></p>
        <div class="flex gap-3 mb-4">
          <input type="text" id="inventoryBarcode" class="modern-input flex-1 px-4 py-2 rounded-xl" placeholder="æ‰«æèµ„äº§æ¡ç è¿›è¡Œç›˜ç‚¹" autofocus>
          <button onclick="addToInventory()" class="modern-btn text-white px-6 py-2 rounded-xl font-medium">æ·»åŠ </button>
          <button onclick="exportInventory()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-xl font-medium">å¯¼å‡ºæŠ¥å‘Š</button>
        </div>
      </div>
      <div id="inventoryList" class="space-y-2"></div>
    </div>
  </div>

  <script>
    /* ===============================
       æ•°æ®å­˜å‚¨å’Œç®¡ç†
    ================================ */
    const STORAGE_KEY = 'assetManagementData';
    let assetsData = {};
    let charts = {};
    let currentInventory = [];

    // åŠ è½½æ•°æ®
    function loadData() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          assetsData = JSON.parse(stored);
        } else {
          // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
          initDemoData();
        }
      } catch (e) {
        console.error('åŠ è½½æ•°æ®å¤±è´¥', e);
        assetsData = {};
      }
    }

    // ä¿å­˜æ•°æ®
    function saveData() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(assetsData));
      } catch (e) {
        console.error('ä¿å­˜æ•°æ®å¤±è´¥', e);
        showMessage('ä¿å­˜å¤±è´¥ï¼', 'error');
      }
    }

    // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
    function initDemoData() {
      const demoAssets = [
        { id: 'ASSET-001', name: 'EPSONæŠ•å½±ä»ª', category: 'ç”µå­è®¾å¤‡', barcode: 'BAR001', status: 'available', purchaseDate: '2023-01-15', price: 5000, location: 'Aæ ‹101', description: 'EPSON EB-S41 æŠ•å½±ä»ª' },
        { id: 'ASSET-002', name: 'ç¬”è®°æœ¬ç”µè„‘', category: 'ç”µå­è®¾å¤‡', barcode: 'BAR002', status: 'borrowed', purchaseDate: '2023-03-20', price: 6500, location: 'Bæ ‹203', description: 'Dell Latitude 5420' },
        { id: 'ASSET-003', name: 'iPad Pro', category: 'ç”µå­è®¾å¤‡', barcode: 'BAR003', status: 'available', purchaseDate: '2023-05-10', price: 7999, location: 'Aæ ‹102', description: 'iPad Pro 12.9è‹±å¯¸' },
        { id: 'ASSET-004', name: 'åŠå…¬æ¡Œ', category: 'å®¶å…·', barcode: 'BAR004', status: 'available', purchaseDate: '2022-08-01', price: 1200, location: 'Cæ ‹301', description: 'å®æœ¨åŠå…¬æ¡Œ 1.6ç±³' },
        { id: 'ASSET-005', name: 'æ‰“å°æœº', category: 'åŠå…¬è®¾å¤‡', barcode: 'BAR005', status: 'maintenance', purchaseDate: '2022-11-15', price: 2800, location: 'Aæ ‹æ‰“å°å®¤', description: 'HP LaserJet Pro' }
      ];

      demoAssets.forEach(asset => {
        assetsData[asset.id] = {
          ...asset,
          borrowHistory: [],
          maintenanceHistory: [],
          inventoryHistory: []
        };
      });

      // æ·»åŠ ä¸€äº›ç¤ºä¾‹å€Ÿç”¨è®°å½•
      assetsData['ASSET-002'].borrowHistory = [{
        borrower: 'å¼ ä¸‰',
        borrowDate: '2024-11-01',
        returnDate: '2024-11-15',
        expectedReturnDate: '2024-11-15',
        note: 'å¼€å‘é¡¹ç›®ä½¿ç”¨',
        status: 'borrowed'
      }];

      // æ·»åŠ ç»´ä¿®è®°å½•
      assetsData['ASSET-005'].maintenanceHistory = [{
        date: '2024-10-20',
        issue: 'æ‰“å°è´¨é‡ä¸‹é™ï¼Œå‡ºç°æ¨ªçº¹',
        solution: 'æ›´æ¢ç¡’é¼“',
        cost: 380,
        status: 'processing'
      }];

      saveData();
    }

    /* ===============================
       å·¥å…·å‡½æ•°
    ================================ */
    function showMessage(message, type = 'success') {
      const el = document.createElement('div');
      el.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-[9999] ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
      el.textContent = message;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 3000);
    }

    function generateAssetId() {
      const count = Object.keys(assetsData).length + 1;
      return `ASSET-${String(count).padStart(3, '0')}`;
    }

    function getStatusText(status) {
      const statusMap = {
        'available': 'å¯ç”¨',
        'borrowed': 'å·²å€Ÿå‡º',
        'maintenance': 'ç»´ä¿®ä¸­',
        'scrapped': 'å·²æŠ¥åºŸ'
      };
      return statusMap[status] || status;
    }

    function getStatusClass(status) {
      const classMap = {
        'available': 'status-available',
        'borrowed': 'status-borrowed',
        'maintenance': 'status-maintenance',
        'scrapped': 'status-scrapped'
      };
      return classMap[status] || '';
    }

    /* ===============================
       ç»Ÿè®¡æ›´æ–°
    ================================ */
    function updateStatistics() {
      const total = Object.keys(assetsData).length;
      const available = Object.values(assetsData).filter(a => a.status === 'available').length;
      const borrowed = Object.values(assetsData).filter(a => a.status === 'borrowed').length;
      const maintenance = Object.values(assetsData).filter(a => a.status === 'maintenance').length;

      document.getElementById('totalAssets').textContent = total;
      document.getElementById('availableAssets').textContent = available;
      document.getElementById('borrowedAssets').textContent = borrowed;
      document.getElementById('maintenanceAssets').textContent = maintenance;
    }

    /* ===============================
       èµ„äº§åˆ—è¡¨
    ================================ */
    function renderAssetsList() {
      const container = document.getElementById('assetsList');
      const assets = Object.values(assetsData);

      if (assets.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-8">æš‚æ— èµ„äº§æ•°æ®</p>';
        return;
      }

      container.innerHTML = assets.map(asset => `
        <div class="glass-effect rounded-xl p-4 card-hover cursor-pointer" onclick="viewAssetDetail('${asset.id}')">
          <div class="flex justify-between items-start mb-3">
            <div>
              <h4 class="text-lg font-semibold text-gray-800">${asset.name}</h4>
              <p class="text-sm text-gray-600">${asset.id}</p>
            </div>
            <span class="status-badge ${getStatusClass(asset.status)}">${getStatusText(asset.status)}</span>
          </div>
          <div class="space-y-1 text-sm text-gray-600">
            <p>ğŸ“‚ åˆ†ç±»ï¼š${asset.category}</p>
            <p>ğŸ“ ä½ç½®ï¼š${asset.location}</p>
            <p>ğŸ’° ä»·æ ¼ï¼šÂ¥${asset.price?.toLocaleString() || '0'}</p>
            ${asset.barcode ? `<p>ğŸ·ï¸ æ¡ç ï¼š${asset.barcode}</p>` : ''}
          </div>
          <div class="mt-3 flex gap-2">
            <button onclick="event.stopPropagation(); editAsset('${asset.id}')" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white text-sm px-3 py-2 rounded-lg transition">ç¼–è¾‘</button>
            <button onclick="event.stopPropagation(); deleteAsset('${asset.id}')" class="flex-1 bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-2 rounded-lg transition">åˆ é™¤</button>
          </div>
        </div>
      `).join('');
    }

    function filterAssets() {
      const search = document.getElementById('searchAsset').value.toLowerCase();
      const category = document.getElementById('filterCategory').value;
      const status = document.getElementById('filterStatus').value;

      let filtered = Object.values(assetsData);

      if (search) {
        filtered = filtered.filter(a =>
          a.name.toLowerCase().includes(search) ||
          a.id.toLowerCase().includes(search) ||
          (a.barcode && a.barcode.toLowerCase().includes(search))
        );
      }

      if (category) {
        filtered = filtered.filter(a => a.category === category);
      }

      if (status) {
        filtered = filtered.filter(a => a.status === status);
      }

      const container = document.getElementById('assetsList');
      if (filtered.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-8">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„èµ„äº§</p>';
        return;
      }

      container.innerHTML = filtered.map(asset => `
        <div class="glass-effect rounded-xl p-4 card-hover cursor-pointer" onclick="viewAssetDetail('${asset.id}')">
          <div class="flex justify-between items-start mb-3">
            <div>
              <h4 class="text-lg font-semibold text-gray-800">${asset.name}</h4>
              <p class="text-sm text-gray-600">${asset.id}</p>
            </div>
            <span class="status-badge ${getStatusClass(asset.status)}">${getStatusText(asset.status)}</span>
          </div>
          <div class="space-y-1 text-sm text-gray-600">
            <p>ğŸ“‚ åˆ†ç±»ï¼š${asset.category}</p>
            <p>ğŸ“ ä½ç½®ï¼š${asset.location}</p>
            <p>ğŸ’° ä»·æ ¼ï¼šÂ¥${asset.price?.toLocaleString() || '0'}</p>
            ${asset.barcode ? `<p>ğŸ·ï¸ æ¡ç ï¼š${asset.barcode}</p>` : ''}
          </div>
          <div class="mt-3 flex gap-2">
            <button onclick="event.stopPropagation(); editAsset('${asset.id}')" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white text-sm px-3 py-2 rounded-lg transition">ç¼–è¾‘</button>
            <button onclick="event.stopPropagation(); deleteAsset('${asset.id}')" class="flex-1 bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-2 rounded-lg transition">åˆ é™¤</button>
          </div>
        </div>
      `).join('');
    }

    function viewAssetDetail(assetId) {
      const asset = assetsData[assetId];
      if (!asset) return;

      const content = document.getElementById('assetDetailContent');
      content.innerHTML = `
        <div class="space-y-6">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-600">èµ„äº§ç¼–å·</p>
              <p class="text-lg font-semibold">${asset.id}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">èµ„äº§åç§°</p>
              <p class="text-lg font-semibold">${asset.name}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">åˆ†ç±»</p>
              <p class="text-lg font-semibold">${asset.category}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">çŠ¶æ€</p>
              <span class="status-badge ${getStatusClass(asset.status)}">${getStatusText(asset.status)}</span>
            </div>
            <div>
              <p class="text-sm text-gray-600">è´­ä¹°æ—¥æœŸ</p>
              <p class="text-lg font-semibold">${asset.purchaseDate}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">ä»·æ ¼</p>
              <p class="text-lg font-semibold">Â¥${asset.price?.toLocaleString() || '0'}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">å­˜æ”¾ä½ç½®</p>
              <p class="text-lg font-semibold">${asset.location}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">æ¡ç å·</p>
              <p class="text-lg font-semibold">${asset.barcode || 'æ— '}</p>
            </div>
          </div>
          ${asset.description ? `
            <div>
              <p class="text-sm text-gray-600">èµ„äº§æè¿°</p>
              <p class="text-gray-800">${asset.description}</p>
            </div>
          ` : ''}

          ${asset.borrowHistory && asset.borrowHistory.length > 0 ? `
            <div>
              <h4 class="text-lg font-semibold text-gray-800 mb-3">å€Ÿç”¨å†å²</h4>
              <div class="space-y-2">
                ${asset.borrowHistory.map(record => `
                  <div class="bg-gray-50 rounded-lg p-3">
                    <p><strong>å€Ÿç”¨äººï¼š</strong>${record.borrower}</p>
                    <p><strong>å€Ÿç”¨æ—¥æœŸï¼š</strong>${record.borrowDate}</p>
                    <p><strong>å½’è¿˜æ—¥æœŸï¼š</strong>${record.returnDate || 'æœªå½’è¿˜'}</p>
                    ${record.note ? `<p><strong>å¤‡æ³¨ï¼š</strong>${record.note}</p>` : ''}
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}

          ${asset.maintenanceHistory && asset.maintenanceHistory.length > 0 ? `
            <div>
              <h4 class="text-lg font-semibold text-gray-800 mb-3">ç»´ä¿®å†å²</h4>
              <div class="space-y-2">
                ${asset.maintenanceHistory.map(record => `
                  <div class="bg-gray-50 rounded-lg p-3">
                    <p><strong>ç»´ä¿®æ—¥æœŸï¼š</strong>${record.date}</p>
                    <p><strong>æ•…éšœæè¿°ï¼š</strong>${record.issue}</p>
                    ${record.solution ? `<p><strong>ç»´ä¿®æ–¹æ¡ˆï¼š</strong>${record.solution}</p>` : ''}
                    ${record.cost ? `<p><strong>è´¹ç”¨ï¼š</strong>Â¥${record.cost}</p>` : ''}
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}
        </div>
      `;

      document.getElementById('assetDetailModal').classList.remove('hidden');
    }

    function closeAssetDetail() {
      document.getElementById('assetDetailModal').classList.add('hidden');
    }

    /* ===============================
       æ–°å¢/ç¼–è¾‘/åˆ é™¤èµ„äº§
    ================================ */
    function openAddAssetModal() {
      document.getElementById('assetId').value = generateAssetId();
      document.getElementById('purchaseDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('addAssetModal').classList.remove('hidden');
    }

    function closeAddAssetModal() {
      document.getElementById('addAssetModal').classList.add('hidden');
      document.getElementById('assetForm').reset();
    }

    function editAsset(assetId) {
      const asset = assetsData[assetId];
      if (!asset) return;

      document.getElementById('assetId').value = asset.id;
      document.getElementById('assetName').value = asset.name;
      document.getElementById('assetCategory').value = asset.category;
      document.getElementById('assetBarcode').value = asset.barcode || '';
      document.getElementById('purchaseDate').value = asset.purchaseDate;
      document.getElementById('assetPrice').value = asset.price;
      document.getElementById('assetLocation').value = asset.location;
      document.getElementById('assetStatus').value = asset.status;
      document.getElementById('assetDescription').value = asset.description || '';

      document.getElementById('addAssetModal').classList.remove('hidden');
    }

    function deleteAsset(assetId) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªèµ„äº§å—ï¼Ÿ')) return;

      delete assetsData[assetId];
      saveData();
      renderAssetsList();
      updateStatistics();
      showMessage('èµ„äº§åˆ é™¤æˆåŠŸï¼', 'success');
    }

    /* ===============================
       å€Ÿç”¨/å½’è¿˜ç®¡ç†
    ================================ */
    function renderBorrowedList() {
      const container = document.getElementById('borrowedList');
      const borrowed = Object.values(assetsData).filter(a => a.status === 'borrowed');

      if (borrowed.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">æš‚æ— å€Ÿå‡ºçš„èµ„äº§</p>';
        return;
      }

      container.innerHTML = borrowed.map(asset => {
        const currentBorrow = asset.borrowHistory.find(h => h.status === 'borrowed');
        if (!currentBorrow) return '';

        return `
          <div class="glass-effect rounded-lg p-4">
            <div class="flex justify-between items-start mb-2">
              <div>
                <h4 class="font-semibold text-gray-800">${asset.name}</h4>
                <p class="text-sm text-gray-600">${asset.id}</p>
              </div>
              <button onclick="returnAsset('${asset.id}')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm transition">å½’è¿˜</button>
            </div>
            <div class="text-sm text-gray-600 space-y-1">
              <p>ğŸ‘¤ å€Ÿç”¨äººï¼š${currentBorrow.borrower}</p>
              <p>ğŸ“… å€Ÿç”¨æ—¥æœŸï¼š${currentBorrow.borrowDate}</p>
              <p>â° é¢„è®¡å½’è¿˜ï¼š${currentBorrow.expectedReturnDate}</p>
              ${currentBorrow.note ? `<p>ğŸ“ å¤‡æ³¨ï¼š${currentBorrow.note}</p>` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    function returnAsset(assetId) {
      const asset = assetsData[assetId];
      if (!asset) return;

      const currentBorrow = asset.borrowHistory.find(h => h.status === 'borrowed');
      if (currentBorrow) {
        currentBorrow.status = 'returned';
        currentBorrow.returnDate = new Date().toISOString().split('T')[0];
      }

      asset.status = 'available';
      saveData();
      renderBorrowedList();
      renderAssetsList();
      updateStatistics();
      showMessage('å½’è¿˜æˆåŠŸï¼', 'success');
    }

    /* ===============================
       ç»´ä¿®è®°å½•
    ================================ */
    function renderMaintenanceList() {
      const container = document.getElementById('maintenanceList');
      let allRecords = [];

      Object.values(assetsData).forEach(asset => {
        if (asset.maintenanceHistory && asset.maintenanceHistory.length > 0) {
          asset.maintenanceHistory.forEach(record => {
            allRecords.push({
              ...record,
              assetId: asset.id,
              assetName: asset.name
            });
          });
        }
      });

      if (allRecords.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">æš‚æ— ç»´ä¿®è®°å½•</p>';
        return;
      }

      allRecords.sort((a, b) => new Date(b.date) - new Date(a.date));

      container.innerHTML = allRecords.map(record => `
        <div class="glass-effect rounded-lg p-4">
          <div class="flex justify-between items-start mb-2">
            <div>
              <h4 class="font-semibold text-gray-800">${record.assetName}</h4>
              <p class="text-sm text-gray-600">${record.assetId}</p>
            </div>
            <span class="status-badge ${record.status === 'completed' ? 'status-available' : 'status-maintenance'}">
              ${record.status === 'completed' ? 'å·²å®Œæˆ' : record.status === 'processing' ? 'ç»´ä¿®ä¸­' : 'å¾…ç»´ä¿®'}
            </span>
          </div>
          <div class="text-sm text-gray-600 space-y-1">
            <p>ğŸ“… ç»´ä¿®æ—¥æœŸï¼š${record.date}</p>
            <p>ğŸ”§ æ•…éšœæè¿°ï¼š${record.issue}</p>
            ${record.solution ? `<p>âœ… ç»´ä¿®æ–¹æ¡ˆï¼š${record.solution}</p>` : ''}
            ${record.cost ? `<p>ğŸ’° ç»´ä¿®è´¹ç”¨ï¼šÂ¥${record.cost}</p>` : ''}
          </div>
        </div>
      `).join('');
    }

    /* ===============================
       æŠ¥åºŸç®¡ç†
    ================================ */
    function renderScrappedList() {
      const container = document.getElementById('scrappedList');
      const scrapped = Object.values(assetsData).filter(a => a.status === 'scrapped');

      if (scrapped.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">æš‚æ— æŠ¥åºŸèµ„äº§</p>';
        return;
      }

      container.innerHTML = scrapped.map(asset => `
        <div class="glass-effect rounded-lg p-4">
          <div class="flex justify-between items-start">
            <div>
              <h4 class="font-semibold text-gray-800">${asset.name}</h4>
              <p class="text-sm text-gray-600">${asset.id}</p>
              <div class="text-sm text-gray-600 mt-2 space-y-1">
                <p>ğŸ“… æŠ¥åºŸæ—¥æœŸï¼š${asset.scrapDate || ''}</p>
                <p>ğŸ“ æŠ¥åºŸåŸå› ï¼š${asset.scrapReason || ''}</p>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    /* ===============================
       ä½¿ç”¨å†å²
    ================================ */
    function renderHistory() {
      const container = document.getElementById('historyList');
      let allHistory = [];

      Object.values(assetsData).forEach(asset => {
        if (asset.borrowHistory && asset.borrowHistory.length > 0) {
          asset.borrowHistory.forEach(record => {
            allHistory.push({
              ...record,
              assetId: asset.id,
              assetName: asset.name,
              type: 'borrow'
            });
          });
        }
      });

      allHistory.sort((a, b) => new Date(b.borrowDate) - new Date(a.borrowDate));

      if (allHistory.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">æš‚æ— ä½¿ç”¨å†å²</p>';
        return;
      }

      container.innerHTML = allHistory.map(record => `
        <div class="glass-effect rounded-lg p-4">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800">${record.assetName}</h4>
              <p class="text-sm text-gray-600">${record.assetId}</p>
              <div class="text-sm text-gray-600 mt-2 space-y-1">
                <p>ğŸ‘¤ å€Ÿç”¨äººï¼š${record.borrower}</p>
                <p>ğŸ“… å€Ÿç”¨æ—¥æœŸï¼š${record.borrowDate}</p>
                <p>ğŸ“… å½’è¿˜æ—¥æœŸï¼š${record.returnDate || 'æœªå½’è¿˜'}</p>
                ${record.note ? `<p>ğŸ“ å¤‡æ³¨ï¼š${record.note}</p>` : ''}
              </div>
            </div>
            <span class="status-badge ${record.status === 'returned' ? 'status-available' : 'status-borrowed'}">
              ${record.status === 'returned' ? 'å·²å½’è¿˜' : 'å€Ÿç”¨ä¸­'}
            </span>
          </div>
        </div>
      `).join('');
    }

    function filterHistory() {
      const search = document.getElementById('historySearch').value.toLowerCase();
      let allHistory = [];

      Object.values(assetsData).forEach(asset => {
        if (asset.borrowHistory && asset.borrowHistory.length > 0) {
          asset.borrowHistory.forEach(record => {
            allHistory.push({
              ...record,
              assetId: asset.id,
              assetName: asset.name
            });
          });
        }
      });

      if (search) {
        allHistory = allHistory.filter(h =>
          h.assetId.toLowerCase().includes(search) ||
          h.assetName.toLowerCase().includes(search) ||
          h.borrower.toLowerCase().includes(search)
        );
      }

      allHistory.sort((a, b) => new Date(b.borrowDate) - new Date(a.borrowDate));

      const container = document.getElementById('historyList');
      if (allHistory.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•</p>';
        return;
      }

      container.innerHTML = allHistory.map(record => `
        <div class="glass-effect rounded-lg p-4">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800">${record.assetName}</h4>
              <p class="text-sm text-gray-600">${record.assetId}</p>
              <div class="text-sm text-gray-600 mt-2 space-y-1">
                <p>ğŸ‘¤ å€Ÿç”¨äººï¼š${record.borrower}</p>
                <p>ğŸ“… å€Ÿç”¨æ—¥æœŸï¼š${record.borrowDate}</p>
                <p>ğŸ“… å½’è¿˜æ—¥æœŸï¼š${record.returnDate || 'æœªå½’è¿˜'}</p>
                ${record.note ? `<p>ğŸ“ å¤‡æ³¨ï¼š${record.note}</p>` : ''}
              </div>
            </div>
            <span class="status-badge ${record.status === 'returned' ? 'status-available' : 'status-borrowed'}">
              ${record.status === 'returned' ? 'å·²å½’è¿˜' : 'å€Ÿç”¨ä¸­'}
            </span>
          </div>
        </div>
      `).join('');
    }

    /* ===============================
       Tab åˆ‡æ¢
    ================================ */
    function switchTab(tabName) {
      // éšè—æ‰€æœ‰ tab content
      document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));

      // ç§»é™¤æ‰€æœ‰ active çŠ¶æ€
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

      // æ˜¾ç¤ºå½“å‰ tab
      document.getElementById(`tab-${tabName}`).classList.remove('hidden');
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

      // æ ¹æ® tab æ¸²æŸ“å¯¹åº”å†…å®¹
      switch(tabName) {
        case 'assets':
          renderAssetsList();
          break;
        case 'borrow':
          renderBorrowedList();
          break;
        case 'maintenance':
          renderMaintenanceList();
          break;
        case 'scrapped':
          renderScrappedList();
          break;
        case 'history':
          renderHistory();
          break;
        case 'charts':
          renderCharts();
          break;
      }
    }

    /* ===============================
       æ¡ç æ‰«æ
    ================================ */
    let barcodeScanner = null;

    function openBarcodeScanner() {
      document.getElementById('barcodeScannerModal').classList.remove('hidden');
      document.getElementById('manualBarcode').focus();

      // å¯åŠ¨æ‘„åƒå¤´æ‰«æ
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        startCameraScanner();
      }
    }

    function closeBarcodeScanner() {
      document.getElementById('barcodeScannerModal').classList.add('hidden');
      if (barcodeScanner) {
        Quagga.stop();
        barcodeScanner = null;
      }
    }

    function startCameraScanner() {
      Quagga.init({
        inputStream: {
          name: "Live",
          type: "LiveStream",
          target: document.querySelector('#barcode-scanner'),
          constraints: {
            facingMode: "environment"
          }
        },
        decoder: {
          readers: ["code_128_reader", "ean_reader", "ean_8_reader", "code_39_reader", "upc_reader"]
        }
      }, function(err) {
        if (err) {
          console.error('æ‘„åƒå¤´åˆå§‹åŒ–å¤±è´¥', err);
          showMessage('æ‘„åƒå¤´å¯åŠ¨å¤±è´¥ï¼Œè¯·ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥', 'error');
          return;
        }
        Quagga.start();
      });

      Quagga.onDetected(function(result) {
        const code = result.codeResult.code;
        document.getElementById('manualBarcode').value = code;
        Quagga.stop();
        searchAssetByBarcode();
      });
    }

    function searchAssetByBarcode() {
      const barcode = document.getElementById('manualBarcode').value.trim();
      if (!barcode) {
        showMessage('è¯·è¾“å…¥æ¡ç å·', 'error');
        return;
      }

      const asset = Object.values(assetsData).find(a => a.barcode === barcode || a.id === barcode);

      if (asset) {
        closeBarcodeScanner();
        viewAssetDetail(asset.id);
      } else {
        showMessage('æœªæ‰¾åˆ°è¯¥èµ„äº§', 'error');
      }
    }

    // æ‰«ç æªæ”¯æŒï¼ˆç›‘å¬å¿«é€Ÿè¾“å…¥ï¼‰
    let barcodeBuffer = '';
    let barcodeTimeout = null;

    document.addEventListener('keypress', function(e) {
      // å¦‚æœåœ¨è¾“å…¥æ¡†ä¸­ï¼Œä¸å¤„ç†
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        return;
      }

      clearTimeout(barcodeTimeout);

      if (e.key === 'Enter') {
        if (barcodeBuffer.length > 3) {
          // æ‰«ç æªè¾“å…¥å®Œæˆ
          const asset = Object.values(assetsData).find(a => a.barcode === barcodeBuffer || a.id === barcodeBuffer);
          if (asset) {
            viewAssetDetail(asset.id);
          }
          barcodeBuffer = '';
        }
      } else {
        barcodeBuffer += e.key;
        barcodeTimeout = setTimeout(() => {
          barcodeBuffer = '';
        }, 100);
      }
    });

    /* ===============================
       ç›˜ç‚¹åŠŸèƒ½
    ================================ */
    function openInventoryModal() {
      currentInventory = [];
      document.getElementById('inventoryDate').textContent = new Date().toLocaleDateString('zh-CN');
      document.getElementById('inventoryModal').classList.remove('hidden');
      document.getElementById('inventoryBarcode').focus();
      renderInventoryList();
    }

    function closeInventoryModal() {
      document.getElementById('inventoryModal').classList.add('hidden');
    }

    function addToInventory() {
      const barcode = document.getElementById('inventoryBarcode').value.trim();
      if (!barcode) {
        showMessage('è¯·è¾“å…¥èµ„äº§æ¡ç ', 'error');
        return;
      }

      const asset = Object.values(assetsData).find(a => a.barcode === barcode || a.id === barcode);

      if (!asset) {
        showMessage('æœªæ‰¾åˆ°è¯¥èµ„äº§', 'error');
        return;
      }

      if (currentInventory.find(item => item.id === asset.id)) {
        showMessage('è¯¥èµ„äº§å·²åœ¨ç›˜ç‚¹åˆ—è¡¨ä¸­', 'error');
        return;
      }

      currentInventory.push({
        id: asset.id,
        name: asset.name,
        category: asset.category,
        status: asset.status,
        time: new Date().toLocaleTimeString('zh-CN')
      });

      // è®°å½•ç›˜ç‚¹å†å²
      if (!asset.inventoryHistory) {
        asset.inventoryHistory = [];
      }
      asset.inventoryHistory.push({
        date: new Date().toISOString().split('T')[0],
        time: new Date().toLocaleTimeString('zh-CN')
      });

      saveData();
      document.getElementById('inventoryBarcode').value = '';
      renderInventoryList();
      showMessage('æ·»åŠ æˆåŠŸ', 'success');
    }

    function renderInventoryList() {
      const container = document.getElementById('inventoryList');

      if (currentInventory.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">å¼€å§‹æ‰«æèµ„äº§æ¡ç è¿›è¡Œç›˜ç‚¹</p>';
        return;
      }

      container.innerHTML = currentInventory.map((item, index) => `
        <div class="glass-effect rounded-lg p-3 flex justify-between items-center">
          <div class="flex-1">
            <span class="font-semibold">${index + 1}. ${item.name}</span>
            <span class="text-sm text-gray-600 ml-2">(${item.id})</span>
            <span class="text-xs text-gray-500 ml-2">${item.time}</span>
          </div>
          <span class="status-badge ${getStatusClass(item.status)}">${getStatusText(item.status)}</span>
        </div>
      `).join('');
    }

    function exportInventory() {
      if (currentInventory.length === 0) {
        showMessage('ç›˜ç‚¹åˆ—è¡¨ä¸ºç©º', 'error');
        return;
      }

      const date = new Date().toLocaleDateString('zh-CN').replace(/\//g, '-');
      let content = `èµ„äº§ç›˜ç‚¹æŠ¥å‘Š\n`;
      content += `ç›˜ç‚¹æ—¥æœŸï¼š${date}\n`;
      content += `ç›˜ç‚¹æ•°é‡ï¼š${currentInventory.length}\n\n`;
      content += `åºå·\tèµ„äº§ç¼–å·\tèµ„äº§åç§°\tåˆ†ç±»\tçŠ¶æ€\tç›˜ç‚¹æ—¶é—´\n`;

      currentInventory.forEach((item, index) => {
        content += `${index + 1}\t${item.id}\t${item.name}\t${item.category}\t${getStatusText(item.status)}\t${item.time}\n`;
      });

      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `èµ„äº§ç›˜ç‚¹æŠ¥å‘Š_${date}.txt`;
      a.click();
      URL.revokeObjectURL(url);

      showMessage('æŠ¥å‘Šå¯¼å‡ºæˆåŠŸ', 'success');
    }

    /* ===============================
       ç»Ÿè®¡å›¾è¡¨
    ================================ */
    function renderCharts() {
      renderStatusChart();
      renderCategoryChart();
      renderBorrowTrendChart();
      renderMaintenanceCostChart();
    }

    function renderStatusChart() {
      const ctx = document.getElementById('statusChart');
      if (!ctx) return;

      if (charts.statusChart) {
        charts.statusChart.destroy();
      }

      const statusCount = {
        'å¯ç”¨': Object.values(assetsData).filter(a => a.status === 'available').length,
        'å·²å€Ÿå‡º': Object.values(assetsData).filter(a => a.status === 'borrowed').length,
        'ç»´ä¿®ä¸­': Object.values(assetsData).filter(a => a.status === 'maintenance').length,
        'å·²æŠ¥åºŸ': Object.values(assetsData).filter(a => a.status === 'scrapped').length
      };

      charts.statusChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(statusCount),
          datasets: [{
            data: Object.values(statusCount),
            backgroundColor: ['#10b981', '#f59e0b', '#ef4444', '#6b7280'],
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    function renderCategoryChart() {
      const ctx = document.getElementById('categoryChart');
      if (!ctx) return;

      if (charts.categoryChart) {
        charts.categoryChart.destroy();
      }

      const categoryCount = {};
      Object.values(assetsData).forEach(asset => {
        if (asset.status !== 'scrapped') {
          categoryCount[asset.category] = (categoryCount[asset.category] || 0) + 1;
        }
      });

      charts.categoryChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(categoryCount),
          datasets: [{
            label: 'èµ„äº§æ•°é‡',
            data: Object.values(categoryCount),
            backgroundColor: '#667eea',
            borderColor: '#764ba2',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    }

    function renderBorrowTrendChart() {
      const ctx = document.getElementById('borrowTrendChart');
      if (!ctx) return;

      if (charts.borrowTrendChart) {
        charts.borrowTrendChart.destroy();
      }

      // ç»Ÿè®¡æœ€è¿‘6ä¸ªæœˆçš„å€Ÿç”¨æ¬¡æ•°
      const monthlyData = {};
      const today = new Date();

      for (let i = 5; i >= 0; i--) {
        const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
        const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
        monthlyData[key] = 0;
      }

      Object.values(assetsData).forEach(asset => {
        if (asset.borrowHistory) {
          asset.borrowHistory.forEach(record => {
            const month = record.borrowDate.substring(0, 7);
            if (monthlyData.hasOwnProperty(month)) {
              monthlyData[month]++;
            }
          });
        }
      });

      charts.borrowTrendChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Object.keys(monthlyData).map(m => m.substring(5) + 'æœˆ'),
          datasets: [{
            label: 'å€Ÿç”¨æ¬¡æ•°',
            data: Object.values(monthlyData),
            borderColor: '#4facfe',
            backgroundColor: 'rgba(79, 172, 254, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    }

    function renderMaintenanceCostChart() {
      const ctx = document.getElementById('maintenanceCostChart');
      if (!ctx) return;

      if (charts.maintenanceCostChart) {
        charts.maintenanceCostChart.destroy();
      }

      // ç»Ÿè®¡æ¯ä¸ªèµ„äº§çš„ç»´ä¿®è´¹ç”¨
      const costData = {};
      Object.values(assetsData).forEach(asset => {
        if (asset.maintenanceHistory && asset.maintenanceHistory.length > 0) {
          const totalCost = asset.maintenanceHistory.reduce((sum, record) => sum + (record.cost || 0), 0);
          if (totalCost > 0) {
            costData[asset.name] = totalCost;
          }
        }
      });

      if (Object.keys(costData).length === 0) {
        costData['æ— ç»´ä¿®è®°å½•'] = 0;
      }

      charts.maintenanceCostChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(costData),
          datasets: [{
            label: 'ç»´ä¿®è´¹ç”¨ï¼ˆå…ƒï¼‰',
            data: Object.values(costData),
            backgroundColor: '#f093fb',
            borderColor: '#f5576c',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    /* ===============================
       è¡¨å•æäº¤äº‹ä»¶
    ================================ */
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
      updateStatistics();
      renderAssetsList();

      // æ–°å¢èµ„äº§è¡¨å•
      document.getElementById('assetForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const assetId = document.getElementById('assetId').value.trim();
        const assetData = {
          id: assetId,
          name: document.getElementById('assetName').value.trim(),
          category: document.getElementById('assetCategory').value,
          barcode: document.getElementById('assetBarcode').value.trim(),
          status: document.getElementById('assetStatus').value,
          purchaseDate: document.getElementById('purchaseDate').value,
          price: parseFloat(document.getElementById('assetPrice').value) || 0,
          location: document.getElementById('assetLocation').value.trim(),
          description: document.getElementById('assetDescription').value.trim(),
          borrowHistory: assetsData[assetId]?.borrowHistory || [],
          maintenanceHistory: assetsData[assetId]?.maintenanceHistory || [],
          inventoryHistory: assetsData[assetId]?.inventoryHistory || []
        };

        assetsData[assetId] = assetData;
        saveData();
        closeAddAssetModal();
        renderAssetsList();
        updateStatistics();
        showMessage('èµ„äº§ä¿å­˜æˆåŠŸï¼', 'success');
      });

      // å€Ÿç”¨è¡¨å•
      document.getElementById('borrowForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const assetId = document.getElementById('borrowAssetId').value.trim();
        const asset = assetsData[assetId];

        if (!asset) {
          showMessage('èµ„äº§ä¸å­˜åœ¨', 'error');
          return;
        }

        if (asset.status !== 'available') {
          showMessage('è¯¥èµ„äº§å½“å‰ä¸å¯å€Ÿç”¨', 'error');
          return;
        }

        const borrowData = {
          borrower: document.getElementById('borrower').value.trim(),
          borrowDate: document.getElementById('borrowDate').value,
          expectedReturnDate: document.getElementById('returnDate').value,
          note: document.getElementById('borrowNote').value.trim(),
          status: 'borrowed'
        };

        if (!asset.borrowHistory) {
          asset.borrowHistory = [];
        }
        asset.borrowHistory.push(borrowData);
        asset.status = 'borrowed';

        saveData();
        this.reset();
        renderBorrowedList();
        renderAssetsList();
        updateStatistics();
        showMessage('å€Ÿç”¨ç™»è®°æˆåŠŸï¼', 'success');
      });

      // ç»´ä¿®è¡¨å•
      document.getElementById('maintenanceForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const assetId = document.getElementById('maintenanceAssetId').value.trim();
        const asset = assetsData[assetId];

        if (!asset) {
          showMessage('èµ„äº§ä¸å­˜åœ¨', 'error');
          return;
        }

        const maintenanceData = {
          date: document.getElementById('maintenanceDate').value,
          issue: document.getElementById('maintenanceIssue').value.trim(),
          solution: document.getElementById('maintenanceSolution').value.trim(),
          cost: parseFloat(document.getElementById('maintenanceCost').value) || 0,
          status: document.getElementById('maintenanceStatus').value
        };

        if (!asset.maintenanceHistory) {
          asset.maintenanceHistory = [];
        }
        asset.maintenanceHistory.push(maintenanceData);

        if (maintenanceData.status !== 'completed') {
          asset.status = 'maintenance';
        }

        saveData();
        this.reset();
        renderMaintenanceList();
        renderAssetsList();
        updateStatistics();
        showMessage('ç»´ä¿®è®°å½•æ·»åŠ æˆåŠŸï¼', 'success');
      });

      // æŠ¥åºŸè¡¨å•
      document.getElementById('scrapForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const assetId = document.getElementById('scrapAssetId').value.trim();
        const asset = assetsData[assetId];

        if (!asset) {
          showMessage('èµ„äº§ä¸å­˜åœ¨', 'error');
          return;
        }

        if (!confirm('ç¡®å®šè¦æŠ¥åºŸè¿™ä¸ªèµ„äº§å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
          return;
        }

        asset.status = 'scrapped';
        asset.scrapDate = document.getElementById('scrapDate').value;
        asset.scrapReason = document.getElementById('scrapReason').value.trim();

        saveData();
        this.reset();
        renderScrappedList();
        renderAssetsList();
        updateStatistics();
        showMessage('èµ„äº§å·²æŠ¥åºŸ', 'success');
      });

      // è®¾ç½®ä»Šå¤©æ—¥æœŸä¸ºé»˜è®¤å€¼
      document.getElementById('borrowDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('maintenanceDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('scrapDate').value = new Date().toISOString().split('T')[0];

      showMessage('èµ„äº§ç®¡ç†ç³»ç»Ÿå·²åŠ è½½å®Œæˆï¼', 'success');
    });
  </script>
</body>
</html>
